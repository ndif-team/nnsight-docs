<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="nnsight.schema" href="schema.html" /><link rel="prev" title="nnsight.tracing" href="tracing.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>nnsight.intervention - NNsight</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">NNsight</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">NNsight</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Learn</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../features.html">Features</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Features</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../documentation.html">Documentation</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="modeling.html">nnsight.modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="tracing.html">nnsight.tracing</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">nnsight.intervention</a></li>
<li class="toctree-l2"><a class="reference internal" href="schema.html">nnsight.schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="util.html">nnsight.util</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/documentation/intervention.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="module-nnsight.intervention">
<span id="nnsight-intervention"></span><h1>nnsight.intervention<a class="headerlink" href="#module-nnsight.intervention" title="Link to this heading">¶</a></h1>
<p>The <cite>intervention</cite> module extends the <cite>tracing</cite> module to add PyTorch specific interventions to a given computation graph.
It defines its own: protocols, contexts, backends and graph primitives to achieve this.</p>
<dl class="py class" id="module-nnsight.intervention.protocols.entrypoint">
<span id="module-nnsight.intervention.protocols"></span><dt class="sig sig-object py" id="nnsight.intervention.protocols.entrypoint.EntryPoint">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.protocols.entrypoint.</span></span><span class="sig-name descname"><span class="pre">EntryPoint</span></span><a class="headerlink" href="#nnsight.intervention.protocols.entrypoint.EntryPoint" title="Link to this definition">¶</a></dt>
<dd><p>An EntryPoint Protocol should have its value set manually outside of normal graph execution.
This makes these type of Nodes special and are handled differently in a variety of cases.
Subclasses EntryPoint informs those cases to handle it differently.
Examples are InterventionProtocol and GradProtocol.</p>
</dd></dl>

<dl class="py class" id="module-nnsight.intervention.protocols.grad">
<dt class="sig sig-object py" id="nnsight.intervention.protocols.grad.GradProtocol">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.protocols.grad.</span></span><span class="sig-name descname"><span class="pre">GradProtocol</span></span><a class="headerlink" href="#nnsight.intervention.protocols.grad.GradProtocol" title="Link to this definition">¶</a></dt>
<dd><p>Protocol which adds a backwards hook via .register_hook() to a Tensor. The hook injects the gradients into the node’s value on hook execution.
Nodes created via this protocol are relative to the next time .backward() was called during tracing allowing separate .grads to reference separate backwards passes:</p>
<p>Uses an attachment to store number of times .backward() has been called during tracing so a given .grad hook is only value injected at the appropriate backwards pass.</p>
<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.protocols.grad.GradProtocol.style">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">style</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#nnsight.intervention.protocols.grad.GradProtocol.style" title="Link to this definition">¶</a></dt>
<dd><p>Visualization style for this protocol node.</p>
<dl class="simple">
<dt>Returns:</dt><dd><ul class="simple">
<li><p>Dict: dictionary style.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-nnsight.intervention.protocols.intervention">
<dt class="sig sig-object py" id="nnsight.intervention.protocols.intervention.InterventionProtocol">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.protocols.intervention.</span></span><span class="sig-name descname"><span class="pre">InterventionProtocol</span></span><a class="headerlink" href="#nnsight.intervention.protocols.intervention.InterventionProtocol" title="Link to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.protocols.intervention.InterventionProtocol.intervene">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">intervene</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">activations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">module_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">module</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interleaver</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.interleaver.Interleaver" title="nnsight.intervention.interleaver.Interleaver"><span class="pre">Interleaver</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.protocols.intervention.InterventionProtocol.intervene" title="Link to this definition">¶</a></dt>
<dd><p>Entry to intervention graph. This should be hooked to all modules involved in the intervention graph.</p>
<p>Forms the current module_path key in the form of &lt;module path&gt;.&lt;output/input&gt;
Checks the graphs InterventionProtocol attachment attribute for this key.
If exists, value is a list of (start:int, end:int) subgraphs to iterate through.
Node args for intervention type nodes should be <code class="docutils literal notranslate"><span class="pre">[module_path,</span> <span class="pre">(batch_start,</span> <span class="pre">batch_size),</span> <span class="pre">iteration]</span></code>.
Checks and updates the counter (number of times this module has been called for this Node) for the given intervention node. If count is not ready yet compared to the iteration, continue.
Using batch_size and batch_start, apply torch.narrow to tensors in activations to select
only batch indexed tensors relevant to this intervention node. Sets the value of a node
using the indexed values. Using torch.narrow returns a view of the tensors as opposed to a copy allowing
subsequent downstream nodes to make edits to the values only in the relevant tensors, and have it update the original
tensors. This both prevents interventions from effecting bathes outside their preview and allows edits
to the output from downstream intervention nodes in the graph.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>activations (Any): Either the inputs or outputs of a torch module.
module_path (str): Module path of the current relevant module relative to the root model.
key (str): Key denoting either “input” or “output” of module.
intervention_handler (InterventionHandler): Handler object that stores the intervention graph and keeps track of module call count.</p>
</dd>
<dt>Returns:</dt><dd><p>Any: The activations, potentially modified by the intervention graph.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.protocols.intervention.InterventionProtocol.style">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">style</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#nnsight.intervention.protocols.intervention.InterventionProtocol.style" title="Link to this definition">¶</a></dt>
<dd><p>Visualization style for this protocol node.</p>
<dl class="simple">
<dt>Returns:</dt><dd><ul class="simple">
<li><p>Dict: dictionary style.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-nnsight.intervention.protocols.module">
<dt class="sig sig-object py" id="nnsight.intervention.protocols.module.ApplyModuleProtocol">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.protocols.module.</span></span><span class="sig-name descname"><span class="pre">ApplyModuleProtocol</span></span><a class="headerlink" href="#nnsight.intervention.protocols.module.ApplyModuleProtocol" title="Link to this definition">¶</a></dt>
<dd><p>Protocol that references some root model, and calls its .forward() method given some input.
Using .forward() vs .__call__() means it wont trigger hooks.
Uses an attachment to the Graph to store the model.</p>
<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.protocols.module.ApplyModuleProtocol.add">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">graph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.graph.graph.InterventionGraph" title="nnsight.intervention.graph.graph.InterventionGraph"><span class="pre">InterventionGraph</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">module_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hook</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#nnsight.intervention.protocols.module.ApplyModuleProtocol.add" title="Link to this definition">¶</a></dt>
<dd><p>Creates and adds an ApplyModuleProtocol to the Graph.
Assumes the attachment has already been added via ApplyModuleProtocol.set_module().</p>
<dl class="simple">
<dt>Args:</dt><dd><p>graph (Graph): Graph to add the Protocol to.
module_path (str): Module path (model.module1.module2 etc), of module to apply from the root module.</p>
</dd>
<dt>Returns:</dt><dd><p>InterventionProxy: ApplyModule Proxy.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.protocols.module.ApplyModuleProtocol.execute">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.graph.node.InterventionNode" title="nnsight.intervention.graph.node.InterventionNode"><span class="pre">InterventionNode</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nnsight.intervention.protocols.module.ApplyModuleProtocol.execute" title="Link to this definition">¶</a></dt>
<dd><p>Executes the ApplyModuleProtocol on Node.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>node (Node): ApplyModule Node.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.protocols.module.ApplyModuleProtocol.style">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">style</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#nnsight.intervention.protocols.module.ApplyModuleProtocol.style" title="Link to this definition">¶</a></dt>
<dd><p>Visualization style for this protocol node.</p>
<dl class="simple">
<dt>Returns:</dt><dd><ul class="simple">
<li><p>Dict: dictionary style.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-nnsight.intervention.contexts.editing">
<span id="module-nnsight.intervention.contexts"></span><span id="module-nnsight.intervention.protocols.swap"></span><dt class="sig sig-object py" id="nnsight.intervention.contexts.editing.EditingTracer">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.contexts.editing.</span></span><span class="sig-name descname"><span class="pre">EditingTracer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.base.NNsight" title="nnsight.intervention.base.NNsight"><span class="pre">NNsight</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.contexts.editing.EditingTracer" title="Link to this definition">¶</a></dt>
<dd><p>The <cite>EditingTracer</cite> exists because we want to return the edited model from __enter__ not the Tracer itself
While were here we might as well force the backend to be <cite>EditingBackend</cite></p>
</dd></dl>

<p id="module-nnsight.intervention.contexts.globals">Global patching allows us to add un-traceable operations to nnsight by replacing them with ones that use the GLOBAL_TRACING_CONTEXT to add the operation to the current graph.</p>
<dl class="py class">
<dt class="sig sig-object py" id="nnsight.intervention.contexts.globals.GlobalInterventionTracingContext">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.contexts.globals.</span></span><span class="sig-name descname"><span class="pre">GlobalInterventionTracingContext</span></span><a class="headerlink" href="#nnsight.intervention.contexts.globals.GlobalInterventionTracingContext" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class" id="module-nnsight.intervention.contexts.interleaving">
<dt class="sig sig-object py" id="nnsight.intervention.contexts.interleaving.InterleavingTracer">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.contexts.interleaving.</span></span><span class="sig-name descname"><span class="pre">InterleavingTracer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.base.NNsight" title="nnsight.intervention.base.NNsight"><span class="pre">NNsight</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backend</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Backend</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">GraphType</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.contexts.interleaving.InterleavingTracer" title="Link to this definition">¶</a></dt>
<dd><p>This is the Tracer type that actually interleaves an <cite>InterventionGraph</cite> with a PyTorch model upon execute.</p>
<dl>
<dt>Attributes:</dt><dd><p>_model (NNsight): NNsight model.
invoker (Invoker): Current open invoker so we can prevent opening two at the same time.
args (Tuple[…]): Positional arguments. First is which method to interleave with and subsequent args are invoker inputs.
kwargs (Dict[str,Any]): Keyword arguments passed to the method to interleave. These are “global” keyword arguments for our chosen methof</p>
<blockquote>
<div><p>while kwargs for a given invoker are used for preprocessing the invoker input.</p>
</div></blockquote>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.contexts.interleaving.InterleavingTracer.invoke">
<span class="sig-name descname"><span class="pre">invoke</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nnsight.intervention.contexts.invoker.Invoker" title="nnsight.intervention.contexts.invoker.Invoker"><span class="pre">Invoker</span></a></span></span><a class="headerlink" href="#nnsight.intervention.contexts.interleaving.InterleavingTracer.invoke" title="Link to this definition">¶</a></dt>
<dd><p>Create an Invoker context for a given input.</p>
<dl class="simple">
<dt>Raises:</dt><dd><p>Exception: If an Invoker context is already open</p>
</dd>
<dt>Returns:</dt><dd><p>Invoker: Invoker.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-nnsight.intervention.contexts.invoker">
<dt class="sig sig-object py" id="nnsight.intervention.contexts.invoker.Invoker">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.contexts.invoker.</span></span><span class="sig-name descname"><span class="pre">Invoker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tracer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.contexts.interleaving.InterleavingTracer" title="nnsight.intervention.contexts.interleaving.InterleavingTracer"><span class="pre">InterleavingTracer</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.contexts.invoker.Invoker" title="Link to this definition">¶</a></dt>
<dd><p>An Invoker is meant to work in tandem with a <code class="xref py py-class docutils literal notranslate"><span class="pre">nnsight.intervention.contexts.InterleavingTracer</span></code> to enter input and manage intervention tracing.</p>
<dl>
<dt>Attributes:</dt><dd><p>tracer (nnsight.contexts.Tracer.Tracer): Tracer object to enter input and manage context.
inputs (tuple[Any]): Initially entered inputs, then post-processed inputs from model’s ._prepare_inputs(…) method.
scan (bool): If to execute the model using <cite>FakeTensor</cite> in order to update the potential sizes/dtypes of all modules’ Envoys’ inputs/outputs as well as validate things work correctly.</p>
<blockquote>
<div><p>Scanning is not free computation wise so you may want to turn this to false when running in a loop.
When making interventions, you made get shape errors if scan is false as it validates operations based on shapes so
for looped calls where shapes are consistent, you may want to have scan=True for the first loop. Defaults to False.</p>
</div></blockquote>
<p>kwargs (Dict[str,Any]): Keyword arguments passed to the model’s _prepare_inputs method.
scanning (bool): If currently scanning.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class" id="module-nnsight.intervention.contexts.local">
<dt class="sig sig-object py" id="nnsight.intervention.contexts.local.LocalContext">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.contexts.local.</span></span><span class="sig-name descname"><span class="pre">LocalContext</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backend:</span> <span class="pre">~nnsight.tracing.backends.base.Backend</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent:</span> <span class="pre">~nnsight.tracing.graph.graph.GraphType</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">graph:</span> <span class="pre">~nnsight.tracing.graph.graph.GraphType</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">graph_class:</span> <span class="pre">~typing.Type[~nnsight.tracing.graph.graph.SubGraph]</span> <span class="pre">=</span> <span class="pre">&lt;class</span> <span class="pre">'nnsight.tracing.graph.graph.SubGraph'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">node_class:</span> <span class="pre">~typing.Type[~nnsight.tracing.graph.node.NodeType]</span> <span class="pre">=</span> <span class="pre">&lt;class</span> <span class="pre">'nnsight.tracing.graph.node.Node'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proxy_class:</span> <span class="pre">~typing.Type[~nnsight.tracing.graph.proxy.ProxyType]</span> <span class="pre">=</span> <span class="pre">&lt;class</span> <span class="pre">'nnsight.tracing.graph.proxy.Proxy'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.contexts.local.LocalContext" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnsight.intervention.contexts.local.RemoteContext">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.contexts.local.</span></span><span class="sig-name descname"><span class="pre">RemoteContext</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backend:</span> <span class="pre">~nnsight.tracing.backends.base.Backend</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent:</span> <span class="pre">~nnsight.tracing.graph.graph.GraphType</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">graph:</span> <span class="pre">~nnsight.tracing.graph.graph.GraphType</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">graph_class:</span> <span class="pre">~typing.Type[~nnsight.tracing.graph.graph.SubGraph]</span> <span class="pre">=</span> <span class="pre">&lt;class</span> <span class="pre">'nnsight.tracing.graph.graph.SubGraph'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">node_class:</span> <span class="pre">~typing.Type[~nnsight.tracing.graph.node.NodeType]</span> <span class="pre">=</span> <span class="pre">&lt;class</span> <span class="pre">'nnsight.tracing.graph.node.Node'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proxy_class:</span> <span class="pre">~typing.Type[~nnsight.tracing.graph.proxy.ProxyType]</span> <span class="pre">=</span> <span class="pre">&lt;class</span> <span class="pre">'nnsight.tracing.graph.proxy.Proxy'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.contexts.local.RemoteContext" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class" id="module-nnsight.intervention.contexts.session">
<dt class="sig sig-object py" id="nnsight.intervention.contexts.session.Session">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.contexts.session.</span></span><span class="sig-name descname"><span class="pre">Session</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.base.NNsight" title="nnsight.intervention.base.NNsight"><span class="pre">NNsight</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">validate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.contexts.session.Session" title="Link to this definition">¶</a></dt>
<dd><p>A Session simply allows grouping multiple Tracers in one computation graph.</p>
</dd></dl>

<dl class="py class" id="module-nnsight.intervention.contexts.tracer">
<dt class="sig sig-object py" id="nnsight.intervention.contexts.tracer.InterventionTracer">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.contexts.tracer.</span></span><span class="sig-name descname"><span class="pre">InterventionTracer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.contexts.tracer.InterventionTracer" title="Link to this definition">¶</a></dt>
<dd><p>Extension of base Tracer to add additional intervention functionality and type hinting for intervention proxies.</p>
<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.contexts.tracer.InterventionTracer.style">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">style</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#nnsight.intervention.contexts.tracer.InterventionTracer.style" title="Link to this definition">¶</a></dt>
<dd><p>Visualization style for this protocol node.</p>
<dl class="simple">
<dt>Returns:</dt><dd><ul class="simple">
<li><p>Dict: dictionary style.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-nnsight.intervention.backends.editing">
<span id="module-nnsight.intervention.backends"></span><dt class="sig sig-object py" id="nnsight.intervention.backends.editing.EditingBackend">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.backends.editing.</span></span><span class="sig-name descname"><span class="pre">EditingBackend</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.base.NNsight" title="nnsight.intervention.base.NNsight"><span class="pre">NNsight</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.backends.editing.EditingBackend" title="Link to this definition">¶</a></dt>
<dd><p>Backend to set the default graph to the current InterventionGraph. Assumes the final Node is an InterleavingTracer.</p>
</dd></dl>

<dl class="py class" id="module-nnsight.intervention.backends.remote">
<dt class="sig sig-object py" id="nnsight.intervention.backends.remote.RemoteBackend">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.backends.remote.</span></span><span class="sig-name descname"><span class="pre">RemoteBackend</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">host</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blocking</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ssl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">api_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.backends.remote.RemoteBackend" title="Link to this definition">¶</a></dt>
<dd><p>Backend to execute a context object via a remote service.</p>
<p>Context object must inherit from RemoteMixin and implement its methods.</p>
<p>Attributes:</p>
<blockquote>
<div><p>url (str): Remote host url. Defaults to that set in CONFIG.API.HOST.</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.backends.remote.RemoteBackend.blocking_request">
<span class="sig-name descname"><span class="pre">blocking_request</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">graph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tracing.html#nnsight.tracing.graph.graph.Graph" title="nnsight.tracing.graph.graph.Graph"><span class="pre">Graph</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#nnsight.intervention.backends.remote.RemoteBackend.blocking_request" title="Link to this definition">¶</a></dt>
<dd><p>Send intervention request to the remote service while waiting for updates via websocket.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>request (RequestModel):Request.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.backends.remote.RemoteBackend.get_response">
<span class="sig-name descname"><span class="pre">get_response</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#nnsight.intervention.backends.remote.RemoteBackend.get_response" title="Link to this definition">¶</a></dt>
<dd><p>Retrieves and handles the response object from the remote endpoint.</p>
<dl class="simple">
<dt>Raises:</dt><dd><p>Exception: If there was a status code other than 200 for the response.</p>
</dd>
<dt>Returns:</dt><dd><p>(ResponseModel): Response.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.backends.remote.RemoteBackend.handle_response">
<span class="sig-name descname"><span class="pre">handle_response</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">response</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ResponseModel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">graph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tracing.html#nnsight.tracing.graph.graph.Graph" title="nnsight.tracing.graph.graph.Graph"><span class="pre">Graph</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#nnsight.intervention.backends.remote.RemoteBackend.handle_response" title="Link to this definition">¶</a></dt>
<dd><p>Handles incoming response data.</p>
<p>Logs the response object.
If the job is completed, retrieve and stream the result from the remote endpoint.
Use torch.load to decode and load the <cite>ResultModel</cite> into memory.
Use the backend object’s .handle_result method to handle the decoded result.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>response (Any): Json data to concert to <cite>ResponseModel</cite></p>
</dd>
<dt>Raises:</dt><dd><p>Exception: If the job’s status is <cite>ResponseModel.JobStatus.ERROR</cite></p>
</dd>
<dt>Returns:</dt><dd><p>ResponseModel: ResponseModel.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.backends.remote.RemoteBackend.non_blocking_request">
<span class="sig-name descname"><span class="pre">non_blocking_request</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">graph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="tracing.html#nnsight.tracing.graph.graph.Graph" title="nnsight.tracing.graph.graph.Graph"><span class="pre">Graph</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.backends.remote.RemoteBackend.non_blocking_request" title="Link to this definition">¶</a></dt>
<dd><p>Send intervention request to the remote service if request provided. Otherwise get job status.</p>
<p>Sets CONFIG.API.JOB_ID on initial request as to later get the status of said job.</p>
<p>When job is completed, clear CONFIG.API.JOB_ID to request a new job.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>request (RequestModel): Request if submitting a new request. Defaults to None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.backends.remote.RemoteBackend.stream_send">
<span class="sig-name descname"><span class="pre">stream_send</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">values</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sio</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">SimpleClient</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.backends.remote.RemoteBackend.stream_send" title="Link to this definition">¶</a></dt>
<dd><p>Upload some value to the remote service for some job id.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>value (Any): Value to upload
job_id (str): Job id.
sio (socketio.SimpleClient): Connected websocket client.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.backends.remote.RemoteBackend.submit_request">
<span class="sig-name descname"><span class="pre">submit_request</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">headers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ResponseModel</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#nnsight.intervention.backends.remote.RemoteBackend.submit_request" title="Link to this definition">¶</a></dt>
<dd><p>Sends request to the remote endpoint and handles the response object.</p>
<dl class="simple">
<dt>Raises:</dt><dd><p>Exception: If there was a status code other than 200 for the response.</p>
</dd>
<dt>Returns:</dt><dd><p>(ResponseModel): Response.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-nnsight.intervention.graph.graph">
<span id="module-nnsight.intervention.graph"></span><dt class="sig sig-object py" id="nnsight.intervention.graph.graph.InterventionGraph">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.graph.graph.</span></span><span class="sig-name descname"><span class="pre">InterventionGraph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.base.NNsight" title="nnsight.intervention.base.NNsight"><span class="pre">NNsight</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.graph.graph.InterventionGraph" title="Link to this definition">¶</a></dt>
<dd><p>The <cite>InterventionGraph</cite> is the special <cite>SubGraph</cite> type that handles the complex intervention operations a user wants to make during interleaving.
We need to <cite>.compile()</cite> it before execution to determine how to execute interventions appropriately.</p>
<dl class="simple">
<dt>Attributes:</dt><dd><p>model (NNsight): NNsight model.
interventions
grad_subgraph
compiled
call_counter
deferred</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.graph.graph.InterventionGraph.clean">
<span class="sig-name descname"><span class="pre">clean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.graph.graph.InterventionGraph.clean" title="Link to this definition">¶</a></dt>
<dd><p>Cleans up dependencies of <cite>Node`s so their values are appropriately memory managed.
Cleans all `Node`s from start to end regardless if they are on this `Graph</cite>.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>start (Optional[int], optional): <cite>Node</cite> index to start cleaning up from. Defaults to None.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.graph.graph.InterventionGraph.cleanup">
<span class="sig-name descname"><span class="pre">cleanup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nnsight.intervention.graph.graph.InterventionGraph.cleanup" title="Link to this definition">¶</a></dt>
<dd><p>Because some modules may be executed more than once, and to accommodate memory management just like a loop,
intervention graph sections defer updating the remaining listeners of Nodes if this is not the last time this section will be executed.
If we never knew it was the last time, there may still be deferred sections after execution.
These will be leftover in graph.deferred, and therefore we need to update their dependencies.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.graph.graph.InterventionGraph.copy">
<span class="sig-name descname"><span class="pre">copy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_graph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Self</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">GraphType</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">memo</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">NodeType</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#nnsight.intervention.graph.graph.InterventionGraph.copy" title="Link to this definition">¶</a></dt>
<dd><p>Creates a shallow copy of this SubGraph.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>new_graph (Optional[SubGraph[NodeType, ProxyType]], optional): SubGraph to copy into. Defaults to None and creates a new SubGraph of the same type.
parent (Optional[Graph[NodeType, ProxyType]], optional): Parent graph. Defaults to None and will create a root <cite>Graph</cite> as the parent.</p>
</dd>
<dt>Returns:</dt><dd><p>Self: New graph.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.graph.graph.InterventionGraph.count">
<span class="sig-name descname"><span class="pre">count</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iteration</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">slice</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#nnsight.intervention.graph.graph.InterventionGraph.count" title="Link to this definition">¶</a></dt>
<dd><p>Increments the count of times a given Intervention Node has tried to be executed and returns if the Node is ready and if it needs to be deferred.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>index (int): Index of intervention node to return count for.
iteration (Union[int, List[int], slice]): What iteration(s) this Node should be executed for.</p>
</dd>
<dt>Returns:</dt><dd><p>bool: If this Node should be executed on this iteration.
bool: If this Node and recursive listeners should have updating their remaining listeners (and therefore their destruction) deferred.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.graph.graph.InterventionGraph.execute">
<span class="sig-name descname"><span class="pre">execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defer</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defer_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nnsight.intervention.graph.graph.InterventionGraph.execute" title="Link to this definition">¶</a></dt>
<dd><p>Executes all <cite>Node`s (operations) in this `Graph</cite>.</p>
<dl class="simple">
<dt>Raises:</dt><dd><p>exception: If there is an exception during executing a <cite>Node</cite>. If so, we need to clean up the dependencies of <a href="#id1"><span class="problematic" id="id2">`</span></a>Node`s yet to be executed.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.graph.graph.InterventionGraph.reset">
<span class="sig-name descname"><span class="pre">reset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nnsight.intervention.graph.graph.InterventionGraph.reset" title="Link to this definition">¶</a></dt>
<dd><p>Resets the <cite>Graph</cite> to prepare for execution.
Simply resets all <cite>Node`s in the `Graph</cite>.</p>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-nnsight.intervention.graph.node">
<dt class="sig sig-object py" id="nnsight.intervention.graph.node.InterventionNode">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.graph.node.</span></span><span class="sig-name descname"><span class="pre">InterventionNode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fake_value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.graph.node.InterventionNode" title="Link to this definition">¶</a></dt>
<dd><p>This is the intervention extension of the base Node type.</p>
<p>It has a fake_value to see information about this Node’s future value before execution.
It adds additional functionality to Node.prepare_inputs to handle Tensors.</p>
<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.graph.node.InterventionNode.prepare_inputs">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">prepare_inputs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">device</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fake</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#nnsight.intervention.graph.node.InterventionNode.prepare_inputs" title="Link to this definition">¶</a></dt>
<dd><p>Override prepare_inputs to make sure</p>
<dl class="simple">
<dt>Args:</dt><dd><p>inputs (Any): _description_
device (Optional[torch.device], optional): _description_. Defaults to None.
fake (bool, optional): _description_. Defaults to False.</p>
</dd>
<dt>Returns:</dt><dd><p>Any: _description_</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.graph.node.InterventionNode.update_dependencies">
<span class="sig-name descname"><span class="pre">update_dependencies</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.graph.node.InterventionNode.update_dependencies" title="Link to this definition">¶</a></dt>
<dd><p>Updates remaining_listeners of dependencies. If they are now redundant, destroy them.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnsight.intervention.graph.node.ValidatingInterventionNode">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.graph.node.</span></span><span class="sig-name descname"><span class="pre">ValidatingInterventionNode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.graph.node.ValidatingInterventionNode" title="Link to this definition">¶</a></dt>
<dd><p>The ValidatingInterventionNode executes its target using the fake_values of all of its dependencies to calculate a new fake_value for this node.
Does not do this if the Node is detached from any graph, already has a fake_value (specified by whoever created the Node) or is a Protocol.</p>
</dd></dl>

<dl class="py class" id="module-nnsight.intervention.graph.proxy">
<dt class="sig sig-object py" id="nnsight.intervention.graph.proxy.InterventionProxy">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.graph.proxy.</span></span><span class="sig-name descname"><span class="pre">InterventionProxy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.graph.node.InterventionNode" title="nnsight.intervention.graph.node.InterventionNode"><span class="pre">InterventionNode</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.graph.proxy.InterventionProxy" title="Link to this definition">¶</a></dt>
<dd><dl class="py property">
<dt class="sig sig-object py" id="nnsight.intervention.graph.proxy.InterventionProxy.device">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">device</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Collection</span><span class="p"><span class="pre">[</span></span><span class="pre">device</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#nnsight.intervention.graph.proxy.InterventionProxy.device" title="Link to this definition">¶</a></dt>
<dd><p>Property to retrieve the device of the traced proxy value or real value.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>Union[torch.Size,Collection[torch.device]]: Proxy value device or collection of devices.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnsight.intervention.graph.proxy.InterventionProxy.dtype">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dtype</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Collection</span><span class="p"><span class="pre">[</span></span><span class="pre">device</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#nnsight.intervention.graph.proxy.InterventionProxy.dtype" title="Link to this definition">¶</a></dt>
<dd><p>Property to retrieve the dtype of the traced proxy value or real value.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>Union[torch.Size,Collection[torch.dtype]]: Proxy value dtype or collection of dtypes.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnsight.intervention.graph.proxy.InterventionProxy.grad">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">grad</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Self</span></em><a class="headerlink" href="#nnsight.intervention.graph.proxy.InterventionProxy.grad" title="Link to this definition">¶</a></dt>
<dd><p>Calling denotes the user wishes to get the grad of proxy tensor and therefore we create a Proxy of that request.
Only generates a proxy the first time it is references otherwise return the already set one.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>Proxy: Grad proxy.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnsight.intervention.graph.proxy.InterventionProxy.shape">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">shape</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Collection</span><span class="p"><span class="pre">[</span></span><span class="pre">Size</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#nnsight.intervention.graph.proxy.InterventionProxy.shape" title="Link to this definition">¶</a></dt>
<dd><p>Property to retrieve the shape of the traced proxy value or real value.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>Union[torch.Size,Collection[torch.Size]]: Proxy value shape or collection of shapes.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-nnsight.intervention.base">
<dt class="sig sig-object py" id="nnsight.intervention.base.NNsight">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.base.</span></span><span class="sig-name descname"><span class="pre">NNsight</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.base.NNsight" title="Link to this definition">¶</a></dt>
<dd><p>Main class to be implemented as a wrapper for PyTorch models wishing to gain this package’s functionality.</p>
<p>Class Attributes:</p>
<blockquote>
<div><p>proxy_class (Type[InterventionProxy]): InterventionProxy like type to use as a Proxy for this Model’s inputs and outputs. Can have Model specific functionality added to a new sub-class.
__methods__ (Dict[str,str]): Mapping of method name, which will open up a .trace context, and the actual method name to execute / interleave with.</p>
<blockquote>
<div><p>For example lets say I had a method on my underlying ._model called <cite>.run</cite> that I wanted to have the NNsight interleaving functionality applied to.
I could define a method on my NNsight sub-class called <cite>._run</cite> which might look like:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">inputs</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">some_preprocessing</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>I could then have my __methods__ attribute look like <cite>__methods__ = {‘run’, ‘_run’}</cite>
This would allow me to do:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div></blockquote>
<dl class="simple">
<dt>Attributes:</dt><dd><p>_model (torch.nn.Module): Underlying torch module.
_envoy (Envoy): Envoy for underlying model.
_session (Session): Session object if in a Session.
_default_graph (Graph): Intervention graph to start from when calling NNsight.trace. This is set via the editing context NNsight.edit.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.base.NNsight.clear_edits">
<span class="sig-name descname"><span class="pre">clear_edits</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nnsight.intervention.base.NNsight.clear_edits" title="Link to this definition">¶</a></dt>
<dd><p>Resets the default graph of this model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.base.NNsight.edit">
<span class="sig-name descname"><span class="pre">edit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nnsight.intervention.contexts.interleaving.InterleavingTracer" title="nnsight.intervention.contexts.interleaving.InterleavingTracer"><span class="pre">InterleavingTracer</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Any</span></span></span><a class="headerlink" href="#nnsight.intervention.base.NNsight.edit" title="Link to this definition">¶</a></dt>
<dd><p>Create a trace context with an edit backend and apply a list of edits.</p>
<p>The edit backend sets a default graph on an NNsight model copy which is
run on future trace calls.</p>
<p>This operation is not inplace!</p>
<dl>
<dt>Args:</dt><dd><p>inplace (bool): If True, makes edits in-place.</p>
</dd>
<dt>Returns:</dt><dd><p>Union[Tracer, Any]: Either the Tracer used for tracing, or the raw output if trace is False.</p>
</dd>
<dt>Example:</dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>from nnsight import LanguageModel</p>
<p>gpt2 = LanguageModel(“openai-community/gpt2)</p>
<dl class="simple">
<dt>class ComplexModule(torch.nn.Module):</dt><dd><dl class="simple">
<dt>def __init__(self):</dt><dd><p>super().__init__()
self.one = WrapperModule()</p>
</dd>
<dt>def forward(self, x):</dt><dd><p>return self.one(x)</p>
</dd>
</dl>
</dd>
</dl>
<p>l0 = gpt2.transformer.h[0]
l0.attachment = ComplexModule()</p>
<dl class="simple">
<dt>with gpt2.edit(“test”) as gpt2_edited:</dt><dd><p>acts = l0.output[0]
l0.output[0][:] = l0.attachment(acts, hook=True)</p>
</dd>
<dt>with gpt2.trace(MSG_prompt):</dt><dd><p>original = l0.output[0].clone().save()
l0.output[0][:] <a href="#id3"><span class="problematic" id="id4">*</span></a>= 0.0
original_output = gpt2.output.logits.save()</p>
</dd>
<dt>with gpt2_edited.trace(MSG_prompt):</dt><dd><p>one = l0.attachment.one.output.clone().save()
l0.attachment.output <a href="#id5"><span class="problematic" id="id6">*</span></a>= 0.0
edited_output = gpt2.output.logits.save()</p>
</dd>
</dl>
<p>print(original_output)
print(edited_output)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.base.NNsight.get">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nnsight.intervention.envoy.Envoy" title="nnsight.intervention.envoy.Envoy"><span class="pre">Envoy</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">InterventionProxyType</span></span></span><a class="headerlink" href="#nnsight.intervention.base.NNsight.get" title="Link to this definition">¶</a></dt>
<dd><p>Gets the Envoy/Proxy via its path.</p>
<dl>
<dt>e.x:</dt><dd><p>model = nnsight.LanguageModel(“openai-community/gpt2”)</p>
<p>module = model.get(‘transformer.h.0.mlp’)</p>
<dl class="simple">
<dt>with model.trace(“Hello”):</dt><dd><p>value = model.get(‘transformer.h.0.mlp.output’).save()</p>
</dd>
</dl>
</dd>
<dt>Args:</dt><dd><p>path (str): ‘.’ separated path.</p>
</dd>
<dt>Returns:</dt><dd><p>Union[Envoy, InterventionProxyType]: Fetched Envoy/Proxy</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.base.NNsight.interleave">
<span class="sig-name descname"><span class="pre">interleave</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">interleaver</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.interleaver.Interleaver" title="nnsight.intervention.interleaver.Interleaver"><span class="pre">Interleaver</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#nnsight.intervention.base.NNsight.interleave" title="Link to this definition">¶</a></dt>
<dd><p>This is the point in nnsight where we finally execute the model and interleave our custom logic.
Simply resolves the function and executes it given some input within the Intreleaver context.
This method is on here vs on the Interleaver because some models might want to define custom interleaving behavior. For example loading real model weights before execution.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>interleaver (Interleaver): Interleaver.
fn (Optional[Union[Callable, str]], optional): Function to interleave with. Defaults to None and therefore NNsight._execute.</p>
</dd>
<dt>Returns:</dt><dd><p>Any: _description_</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nnsight.intervention.base.NNsight.proxy_class">
<span class="sig-name descname"><span class="pre">proxy_class</span></span><a class="headerlink" href="#nnsight.intervention.base.NNsight.proxy_class" title="Link to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#nnsight.intervention.graph.proxy.InterventionProxy" title="nnsight.intervention.graph.proxy.InterventionProxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">InterventionProxy</span></code></a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.base.NNsight.scan">
<span class="sig-name descname"><span class="pre">scan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">inputs</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nnsight.intervention.contexts.interleaving.InterleavingTracer" title="nnsight.intervention.contexts.interleaving.InterleavingTracer"><span class="pre">InterleavingTracer</span></a></span></span><a class="headerlink" href="#nnsight.intervention.base.NNsight.scan" title="Link to this definition">¶</a></dt>
<dd><p>Context just to populate fake tensor proxy values using scan and validate.
Useful when looking for just the shapes of future tensors</p>
<p>Examples:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">model</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>

    <span class="n">dim</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<dl class="simple">
<dt>Returns:</dt><dd><p>Tracer: Tracer context with Noop backend.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.base.NNsight.session">
<span class="sig-name descname"><span class="pre">session</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">backend</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Backend</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nnsight.intervention.contexts.session.Session" title="nnsight.intervention.contexts.session.Session"><span class="pre">Session</span></a></span></span><a class="headerlink" href="#nnsight.intervention.base.NNsight.session" title="Link to this definition">¶</a></dt>
<dd><p>Create a session context using a Session.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>backend (Backend): Backend for this Session object.</p>
</dd>
<dt>Returns:</dt><dd><p>Session: Session.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.base.NNsight.to">
<span class="sig-name descname"><span class="pre">to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#nnsight.intervention.base.NNsight.to" title="Link to this definition">¶</a></dt>
<dd><p>Override torch.nn.Module.to so this returns the NNSight model, not the underlying module when doing: model = model.to(…)</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>Envoy: Envoy.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.base.NNsight.trace">
<span class="sig-name descname"><span class="pre">trace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invoker_kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backend</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Backend</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nnsight.intervention.contexts.interleaving.InterleavingTracer" title="nnsight.intervention.contexts.interleaving.InterleavingTracer"><span class="pre">InterleavingTracer</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Any</span></span></span><a class="headerlink" href="#nnsight.intervention.base.NNsight.trace" title="Link to this definition">¶</a></dt>
<dd><p>Entrypoint into the tracing and interleaving functionality nnsight provides.</p>
<p>In short, allows access to the future inputs and outputs of modules in order to trace what operations you would like to perform on them.
This can be as simple as accessing and saving activations for inspection, or as complicated as transforming the activations and gradients in a forward pass over multiple inputs.</p>
<dl>
<dt>Args:</dt><dd><dl class="simple">
<dt>inputs (tuple[Any]): When positional arguments are provided directly to .trace, we assume there is only one Invoker and therefore</dt><dd><p>immediately create an enter an Invoker.</p>
</dd>
</dl>
<p>trace (bool, optional): If to open a tracing context. Otherwise immediately run the model and return the raw output. Defaults to True.
scan (bool): Exposed invoker kwarg to scan for the provided input. No effect if there is no input.
method (Optional[str]): String name of method to interleave with. Defaults to None and therefore NNsight._execute
invoker_kwargs (Dict[str, Any], optional): Keyword arguments to pass to Invoker initialization, and then downstream to the model’s .prepare_inputs(…) method. Used when giving input directly to <cite>.trace(…)</cite>. Defaults to None.
kwargs (Dict[str, Any]): Keyword arguments passed to Tracer initialization, and then downstream to the model’s execution method.</p>
</dd>
<dt>Raises:</dt><dd><p>ValueError: If trace is False and no inputs were provided (nothing to run with)</p>
</dd>
<dt>Returns:</dt><dd><p>Union[Tracer, Any]: Either the Tracer used for tracing, or the raw output if trace is False.</p>
</dd>
</dl>
<p>Examples:</p>
<blockquote>
<div><p>There are a few ways you can use <code class="docutils literal notranslate"><span class="pre">.trace(...)</span></code> depending in your use case.</p>
<p>Lets use this extremely basic model for our examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="n">input_size</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">hidden_dims</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">output_size</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;layer1&#39;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_dims</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;sigma1&#39;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;layer2&#39;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dims</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;sigma2&#39;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">()),</span>
<span class="p">]))</span>

<span class="n">example_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">input_size</span><span class="p">))</span>
</pre></div>
</div>
<p>The first example has us running the model with a single example input, and saving the input and output of ‘layer2’ as well as the final output using the tracing context.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">nnsight</span><span class="w"> </span><span class="kn">import</span> <span class="n">NNsight</span>

<span class="k">with</span> <span class="n">NNsight</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">example_input</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>

    <span class="n">l2_input</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layer2</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">l2_output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layer2</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">l2_input</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l2_output</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>The second example allows us to divide up multiple inputs into one batch, and scope an inner invoker context to each one.
We indicate this simply by not passing and positional inputs into <cite>.trace(…)</cite>. The Tracer object then expects you to enter each input via <cite>Tracer.invoke(…)</cite></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">example_input2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">input_size</span><span class="p">))</span>

<span class="k">with</span> <span class="n">NNsight</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>

    <span class="k">with</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">example_input</span><span class="p">):</span>

        <span class="n">output1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">example_input2</span><span class="p">):</span>

        <span class="n">output2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">output1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output2</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-nnsight.intervention.envoy">
<dt class="sig sig-object py" id="nnsight.intervention.envoy.Envoy">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.envoy.</span></span><span class="sig-name descname"><span class="pre">Envoy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">module_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alias_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.envoy.Envoy" title="Link to this definition">¶</a></dt>
<dd><p>Envoy objects act as proxies for torch modules themselves within a model’s module tree in order to add nnsight functionality.
Proxies of the underlying module’s output and input are accessed by <cite>.output</cite> and <cite>.input</cite> respectively.</p>
<dl>
<dt>Attributes:</dt><dd><p>path (str): String representing the attribute path of this Envoy’s module relative the the root model. Separated by ‘.’ e.x (‘.transformer.h.0.mlp’).
output (nnsight.intervention.InterventionProxy): Proxy object representing the output of this Envoy’s module. Reset on forward pass.
inputs (nnsight.intervention.InterventionProxy): Proxy object representing the inputs of this Envoy’s module. Proxy is in the form of (Tuple[Tuple[&lt;Positional arg&gt;], Dict[str, &lt;Keyword arg&gt;]])Reset on forward pass.
input (nnsight.intervention.InterventionProxy): Alias for the first positional Proxy input i.e Envoy.inputs[0][0]
iter (nnsight.envoy.EnvoyIterator): Iterator object allowing selection of specific .input and .output iterations of this Envoy.
_module (torch.nn.Module): Underlying torch module.
_children (List[Envoy]): Immediate Envoy children of this Envoy.
_fake_outputs (List[torch.Tensor]): List of ‘meta’ tensors built from the outputs most recent _scan. Is list as there can be multiple shapes for a module called more than once.
_fake_inputs (List[torch.Tensor]): List of ‘meta’ tensors built from the inputs most recent _scan. Is list as there can be multiple shapes for a module called more than once.
_rename (Optional[Dict[str,str]]): Optional mapping of (old name -&gt; new name).</p>
<blockquote>
<div><p>For example to rename all gpt ‘attn’ modules to ‘attention’ you would: rename={r”attn”: “attention”}
Not this does not actually change the underlying module names, just how you access its envoy. Renaming will replace Envoy.path but Envoy._path represents the pre-renamed true attribute path.</p>
</div></blockquote>
<p>_tracer (nnsight.context.Tracer.Tracer): Object which adds this Envoy’s module’s output and input proxies to an intervention graph. Must be set on Envoys objects manually by the Tracer.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.envoy.Envoy.all">
<span class="sig-name descname"><span class="pre">all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">propagate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nnsight.intervention.envoy.Envoy" title="nnsight.intervention.envoy.Envoy"><span class="pre">Envoy</span></a></span></span><a class="headerlink" href="#nnsight.intervention.envoy.Envoy.all" title="Link to this definition">¶</a></dt>
<dd><p>By default, this modules inputs and outputs only refer to the first time its called. Use <a href="#id7"><span class="problematic" id="id8">`</span></a>.all()`to have .input and .output refer to all iterations.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>Envoy: Self.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnsight.intervention.envoy.Envoy.input">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">input</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">InterventionProxyType</span></em><a class="headerlink" href="#nnsight.intervention.envoy.Envoy.input" title="Link to this definition">¶</a></dt>
<dd><p>Getting the first positional argument input of the model’s module.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>InterventionProxy: Input proxy.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnsight.intervention.envoy.Envoy.inputs">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">inputs</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">InterventionProxyType</span></em><a class="headerlink" href="#nnsight.intervention.envoy.Envoy.inputs" title="Link to this definition">¶</a></dt>
<dd><p>Calling denotes the user wishes to get the input of the underlying module and therefore we create a Proxy of that request.
Only generates a proxy the first time it is references otherwise return the already set one.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>InterventionProxy: Input proxy.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.envoy.Envoy.modules">
<span class="sig-name descname"><span class="pre">modules</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">include_fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#nnsight.intervention.envoy.Envoy" title="nnsight.intervention.envoy.Envoy"><span class="pre">Envoy</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">envoys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#nnsight.intervention.envoy.Envoy" title="nnsight.intervention.envoy.Envoy"><span class="pre">Envoy</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#nnsight.intervention.envoy.Envoy.modules" title="Link to this definition">¶</a></dt>
<dd><p>Returns all Envoys in the Envoy tree.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>include_fn (Callable, optional): Optional function to be ran against all Envoys to check if they should be included in the final collection of Envoys. Defaults to None.
names (bool, optional): If to include the name/module_path of returned Envoys along with the Envoy itself. Defaults to False.</p>
</dd>
<dt>Returns:</dt><dd><p>List[Envoy]: Included Envoys</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.envoy.Envoy.named_modules">
<span class="sig-name descname"><span class="pre">named_modules</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#nnsight.intervention.envoy.Envoy" title="nnsight.intervention.envoy.Envoy"><span class="pre">Envoy</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#nnsight.intervention.envoy.Envoy.named_modules" title="Link to this definition">¶</a></dt>
<dd><p>Returns all Envoys in the Envoy tree along with their name/module_path.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>include_fn (Callable, optional): Optional function to be ran against all Envoys to check if they should be included in the final collection of Envoys. Defaults to None.</p>
</dd>
<dt>Returns:</dt><dd><p>List[Tuple[str, Envoy]]: Included Envoys and their names/module_paths.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.envoy.Envoy.next">
<span class="sig-name descname"><span class="pre">next</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">increment</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nnsight.intervention.envoy.Envoy" title="nnsight.intervention.envoy.Envoy"><span class="pre">Envoy</span></a></span></span><a class="headerlink" href="#nnsight.intervention.envoy.Envoy.next" title="Link to this definition">¶</a></dt>
<dd><p>By default, this modules inputs and outputs only refer to the first time its called. Use <a href="#id9"><span class="problematic" id="id10">`</span></a>.next()`to select which iteration .input an .output refer to.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>increment (int, optional): How many iterations to jump. Defaults to 1.</p>
</dd>
<dt>Returns:</dt><dd><p>Envoy: Self.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnsight.intervention.envoy.Envoy.output">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">output</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">InterventionProxyType</span></em><a class="headerlink" href="#nnsight.intervention.envoy.Envoy.output" title="Link to this definition">¶</a></dt>
<dd><p>Calling denotes the user wishes to get the output of the underlying module and therefore we create a Proxy of that request.
Only generates a proxy the first time it is references otherwise return the already set one.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>InterventionProxy: Output proxy.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nnsight.intervention.envoy.Envoy.to">
<span class="sig-name descname"><span class="pre">to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nnsight.intervention.envoy.Envoy" title="nnsight.intervention.envoy.Envoy"><span class="pre">Envoy</span></a></span></span><a class="headerlink" href="#nnsight.intervention.envoy.Envoy.to" title="Link to this definition">¶</a></dt>
<dd><p>Override torch.nn.Module.to so this returns the Envoy, not the underlying module when doing: model = model.to(…)</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>Envoy: Envoy.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nnsight.intervention.envoy.IterationEnvoy">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.envoy.</span></span><span class="sig-name descname"><span class="pre">IterationEnvoy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">envoy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.envoy.Envoy" title="nnsight.intervention.envoy.Envoy"><span class="pre">Envoy</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.envoy.IterationEnvoy" title="Link to this definition">¶</a></dt>
<dd><dl class="py property">
<dt class="sig sig-object py" id="nnsight.intervention.envoy.IterationEnvoy.input">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">input</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">InterventionProxyType</span></em><a class="headerlink" href="#nnsight.intervention.envoy.IterationEnvoy.input" title="Link to this definition">¶</a></dt>
<dd><p>Getting the first positional argument input of the model’s module.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>InterventionProxy: Input proxy.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="nnsight.intervention.envoy.IterationEnvoy.output">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">output</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">InterventionProxyType</span></em><a class="headerlink" href="#nnsight.intervention.envoy.IterationEnvoy.output" title="Link to this definition">¶</a></dt>
<dd><p>Calling denotes the user wishes to get the output of the underlying module and therefore we create a Proxy of that request.
Only generates a proxy the first time it is references otherwise return the already set one.</p>
<dl class="simple">
<dt>Returns:</dt><dd><p>InterventionProxy: Output proxy.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-nnsight.intervention.interleaver">
<dt class="sig sig-object py" id="nnsight.intervention.interleaver.Interleaver">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nnsight.intervention.interleaver.</span></span><span class="sig-name descname"><span class="pre">Interleaver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">graph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nnsight.intervention.graph.graph.InterventionGraph" title="nnsight.intervention.graph.graph.InterventionGraph"><span class="pre">InterventionGraph</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_groups</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_hook</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_hook</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nnsight.intervention.interleaver.Interleaver" title="Link to this definition">¶</a></dt>
<dd><p>The Interleaver is responsible for executing a function involving a PyTorch model alongside a user’s custom functionality
(represented by an <cite>InterventionGraph</cite>). This is called interleaving.</p>
<p>The <cite>InterventionGraph</cite> has information about which components (modules) of the model the user’s custom logic will interact with.
As the <cite>Interleaver</cite> is a context, entering it adds the appropriate hooks to these components which act as a bridge between the model’s
original computation graph and the <cite>InterventionGraph</cite>. Exiting the <cite>Interleaver</cite> removes these hooks.</p>
<dl>
<dt>Attributes:</dt><dd><p>graph (InterventionGraph): The computation graph representing the user’s custom intervention logic.
batch_groups (Optional[List[Tuple[int, int]]]): A batch group is a section of tensor values related to a given intervention.</p>
<blockquote>
<div><p>They are a tuple of (batch_start, batch_length). So if batch group 0 was (0, 4) it means it starts at index 0 and goes until index 3.
The batch index is assumed to be the first dimension of all Tensors.
InterventionProtocol Nodes know which batch group they are a part of in their arguments. That value is the index into the batch_groups.</p>
</div></blockquote>
<p>input_hook (Optional[Callable]). Function to hook onto the inputs of modules for interleaving. Defaults to None and therefore <cite>InterventionProtocol.intervene</cite>.
output_hook (Optional[Callable]). Function to hook onto the outputs of modules for interleaving. Defaults to None and therefore <cite>InterventionProtocol.intervene</cite>.
batch_size (Optional[int]). Total batch size. Used to determine which Tensors need to be narrowed to their batch group.</p>
<blockquote>
<div><p>i.e If a Tensor’s first dimension isn’t batch_size, we dont need to narrow it to convert it for its batch_group.
Defaults to None and therefore the sum of the last batch_group.</p>
</div></blockquote>
</dd>
</dl>
</dd></dl>

</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="schema.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">nnsight.schema</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="tracing.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">nnsight.tracing</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Jaden Fiotto-Kaufman
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">nnsight.intervention</a><ul>
<li><a class="reference internal" href="#nnsight.intervention.protocols.entrypoint.EntryPoint"><code class="docutils literal notranslate"><span class="pre">EntryPoint</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.protocols.grad.GradProtocol"><code class="docutils literal notranslate"><span class="pre">GradProtocol</span></code></a><ul>
<li><a class="reference internal" href="#nnsight.intervention.protocols.grad.GradProtocol.style"><code class="docutils literal notranslate"><span class="pre">GradProtocol.style()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#nnsight.intervention.protocols.intervention.InterventionProtocol"><code class="docutils literal notranslate"><span class="pre">InterventionProtocol</span></code></a><ul>
<li><a class="reference internal" href="#nnsight.intervention.protocols.intervention.InterventionProtocol.intervene"><code class="docutils literal notranslate"><span class="pre">InterventionProtocol.intervene()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.protocols.intervention.InterventionProtocol.style"><code class="docutils literal notranslate"><span class="pre">InterventionProtocol.style()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#nnsight.intervention.protocols.module.ApplyModuleProtocol"><code class="docutils literal notranslate"><span class="pre">ApplyModuleProtocol</span></code></a><ul>
<li><a class="reference internal" href="#nnsight.intervention.protocols.module.ApplyModuleProtocol.add"><code class="docutils literal notranslate"><span class="pre">ApplyModuleProtocol.add()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.protocols.module.ApplyModuleProtocol.execute"><code class="docutils literal notranslate"><span class="pre">ApplyModuleProtocol.execute()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.protocols.module.ApplyModuleProtocol.style"><code class="docutils literal notranslate"><span class="pre">ApplyModuleProtocol.style()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#nnsight.intervention.contexts.editing.EditingTracer"><code class="docutils literal notranslate"><span class="pre">EditingTracer</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.contexts.globals.GlobalInterventionTracingContext"><code class="docutils literal notranslate"><span class="pre">GlobalInterventionTracingContext</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.contexts.interleaving.InterleavingTracer"><code class="docutils literal notranslate"><span class="pre">InterleavingTracer</span></code></a><ul>
<li><a class="reference internal" href="#nnsight.intervention.contexts.interleaving.InterleavingTracer.invoke"><code class="docutils literal notranslate"><span class="pre">InterleavingTracer.invoke()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#nnsight.intervention.contexts.invoker.Invoker"><code class="docutils literal notranslate"><span class="pre">Invoker</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.contexts.local.LocalContext"><code class="docutils literal notranslate"><span class="pre">LocalContext</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.contexts.local.RemoteContext"><code class="docutils literal notranslate"><span class="pre">RemoteContext</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.contexts.session.Session"><code class="docutils literal notranslate"><span class="pre">Session</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.contexts.tracer.InterventionTracer"><code class="docutils literal notranslate"><span class="pre">InterventionTracer</span></code></a><ul>
<li><a class="reference internal" href="#nnsight.intervention.contexts.tracer.InterventionTracer.style"><code class="docutils literal notranslate"><span class="pre">InterventionTracer.style()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#nnsight.intervention.backends.editing.EditingBackend"><code class="docutils literal notranslate"><span class="pre">EditingBackend</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.backends.remote.RemoteBackend"><code class="docutils literal notranslate"><span class="pre">RemoteBackend</span></code></a><ul>
<li><a class="reference internal" href="#nnsight.intervention.backends.remote.RemoteBackend.blocking_request"><code class="docutils literal notranslate"><span class="pre">RemoteBackend.blocking_request()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.backends.remote.RemoteBackend.get_response"><code class="docutils literal notranslate"><span class="pre">RemoteBackend.get_response()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.backends.remote.RemoteBackend.handle_response"><code class="docutils literal notranslate"><span class="pre">RemoteBackend.handle_response()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.backends.remote.RemoteBackend.non_blocking_request"><code class="docutils literal notranslate"><span class="pre">RemoteBackend.non_blocking_request()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.backends.remote.RemoteBackend.stream_send"><code class="docutils literal notranslate"><span class="pre">RemoteBackend.stream_send()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.backends.remote.RemoteBackend.submit_request"><code class="docutils literal notranslate"><span class="pre">RemoteBackend.submit_request()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#nnsight.intervention.graph.graph.InterventionGraph"><code class="docutils literal notranslate"><span class="pre">InterventionGraph</span></code></a><ul>
<li><a class="reference internal" href="#nnsight.intervention.graph.graph.InterventionGraph.clean"><code class="docutils literal notranslate"><span class="pre">InterventionGraph.clean()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.graph.graph.InterventionGraph.cleanup"><code class="docutils literal notranslate"><span class="pre">InterventionGraph.cleanup()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.graph.graph.InterventionGraph.copy"><code class="docutils literal notranslate"><span class="pre">InterventionGraph.copy()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.graph.graph.InterventionGraph.count"><code class="docutils literal notranslate"><span class="pre">InterventionGraph.count()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.graph.graph.InterventionGraph.execute"><code class="docutils literal notranslate"><span class="pre">InterventionGraph.execute()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.graph.graph.InterventionGraph.reset"><code class="docutils literal notranslate"><span class="pre">InterventionGraph.reset()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#nnsight.intervention.graph.node.InterventionNode"><code class="docutils literal notranslate"><span class="pre">InterventionNode</span></code></a><ul>
<li><a class="reference internal" href="#nnsight.intervention.graph.node.InterventionNode.prepare_inputs"><code class="docutils literal notranslate"><span class="pre">InterventionNode.prepare_inputs()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.graph.node.InterventionNode.update_dependencies"><code class="docutils literal notranslate"><span class="pre">InterventionNode.update_dependencies()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#nnsight.intervention.graph.node.ValidatingInterventionNode"><code class="docutils literal notranslate"><span class="pre">ValidatingInterventionNode</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.graph.proxy.InterventionProxy"><code class="docutils literal notranslate"><span class="pre">InterventionProxy</span></code></a><ul>
<li><a class="reference internal" href="#nnsight.intervention.graph.proxy.InterventionProxy.device"><code class="docutils literal notranslate"><span class="pre">InterventionProxy.device</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.graph.proxy.InterventionProxy.dtype"><code class="docutils literal notranslate"><span class="pre">InterventionProxy.dtype</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.graph.proxy.InterventionProxy.grad"><code class="docutils literal notranslate"><span class="pre">InterventionProxy.grad</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.graph.proxy.InterventionProxy.shape"><code class="docutils literal notranslate"><span class="pre">InterventionProxy.shape</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#nnsight.intervention.base.NNsight"><code class="docutils literal notranslate"><span class="pre">NNsight</span></code></a><ul>
<li><a class="reference internal" href="#nnsight.intervention.base.NNsight.clear_edits"><code class="docutils literal notranslate"><span class="pre">NNsight.clear_edits()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.base.NNsight.edit"><code class="docutils literal notranslate"><span class="pre">NNsight.edit()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.base.NNsight.get"><code class="docutils literal notranslate"><span class="pre">NNsight.get()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.base.NNsight.interleave"><code class="docutils literal notranslate"><span class="pre">NNsight.interleave()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.base.NNsight.proxy_class"><code class="docutils literal notranslate"><span class="pre">NNsight.proxy_class</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.base.NNsight.scan"><code class="docutils literal notranslate"><span class="pre">NNsight.scan()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.base.NNsight.session"><code class="docutils literal notranslate"><span class="pre">NNsight.session()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.base.NNsight.to"><code class="docutils literal notranslate"><span class="pre">NNsight.to()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.base.NNsight.trace"><code class="docutils literal notranslate"><span class="pre">NNsight.trace()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#nnsight.intervention.envoy.Envoy"><code class="docutils literal notranslate"><span class="pre">Envoy</span></code></a><ul>
<li><a class="reference internal" href="#nnsight.intervention.envoy.Envoy.all"><code class="docutils literal notranslate"><span class="pre">Envoy.all()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.envoy.Envoy.input"><code class="docutils literal notranslate"><span class="pre">Envoy.input</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.envoy.Envoy.inputs"><code class="docutils literal notranslate"><span class="pre">Envoy.inputs</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.envoy.Envoy.modules"><code class="docutils literal notranslate"><span class="pre">Envoy.modules()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.envoy.Envoy.named_modules"><code class="docutils literal notranslate"><span class="pre">Envoy.named_modules()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.envoy.Envoy.next"><code class="docutils literal notranslate"><span class="pre">Envoy.next()</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.envoy.Envoy.output"><code class="docutils literal notranslate"><span class="pre">Envoy.output</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.envoy.Envoy.to"><code class="docutils literal notranslate"><span class="pre">Envoy.to()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#nnsight.intervention.envoy.IterationEnvoy"><code class="docutils literal notranslate"><span class="pre">IterationEnvoy</span></code></a><ul>
<li><a class="reference internal" href="#nnsight.intervention.envoy.IterationEnvoy.input"><code class="docutils literal notranslate"><span class="pre">IterationEnvoy.input</span></code></a></li>
<li><a class="reference internal" href="#nnsight.intervention.envoy.IterationEnvoy.output"><code class="docutils literal notranslate"><span class="pre">IterationEnvoy.output</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#nnsight.intervention.interleaver.Interleaver"><code class="docutils literal notranslate"><span class="pre">Interleaver</span></code></a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=1dd76d02"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>